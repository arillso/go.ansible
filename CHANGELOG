# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [1.2.0] - 2025-10-25

### Added

- SSH key format validation in `writeTempFile()` to detect invalid PEM format early
- New `isValidSSHKey()` function to validate SSH private keys with matching BEGIN/END marker validation
- Support for all common SSH key formats: RSA, OpenSSH, EC, DSA, and generic PRIVATE KEY
- Comprehensive test suite with 32 new test cases for SSH key validation and normalization
- `TestWriteTempFileLineEndings` test function with 5 scenarios for line ending normalization
- `TestWriteTempFileSSHKeyValidation` test function with 13 scenarios for key validation
- `TestIsValidSSHKey` test function with 14 scenarios for format validation
- Security scanner configurations (`.gitleaks.toml`, `.secretlintignore`) to properly handle test fixtures

### Fixed

- SSH key line ending normalization: CRLF (Windows) line endings are now automatically converted to LF (Unix)
- Trailing newline handling: SSH keys now always end with a newline as required by PEM format (RFC 7468)
- Invalid SSH key detection: Keys with missing or malformed PEM markers are now rejected with clear error messages
- Compatibility with GitHub Secrets on Windows: Keys stored in GitHub Secrets with CRLF line endings now work correctly

### Changed

- Enhanced `writeTempFile()` function to normalize content before writing
- Updated `TestPrepareTempFiles` to use valid PEM-formatted SSH keys
- Improved error messages for SSH key validation failures

### Security

- Early detection of invalid SSH keys prevents potential SSH connection failures
- Better validation reduces the risk of using malformed credentials

[1.2.0]: https://github.com/arillso/go.ansible/compare/v1.1.0...v1.2.0

## [1.1.0] - 2025-10-25

### Added

- Support for running playbooks from Ansible Collections using FQCN (Fully Qualified Collection Name) format
- Collection playbooks can now be specified using the format `namespace.collection.playbook_name` without requiring local files
- `isCollectionPlaybook()` helper function to distinguish between local file paths and collection FQCNs
- Comprehensive test coverage for collection playbook functionality (3 new test functions with 7+ test cases)
- Automatic detection and handling of collection playbook references in `resolvePlaybooks()` function

### Changed

- Update GitHub Actions workflows with SHA-pinned versions for improved security
- Update `actions/checkout` from v4 to v5
- Update `oxsecurity/megalinter` from v8 to v9
- Update `actions/upload-artifact` from v4 to v5
- Update `actions/setup-go` from v5 to v6
- Update `stefanzweifel/git-auto-commit-action` from v5 to v7
- Update Go version from 1.23 to 1.25 in CI/CD pipeline
- Enhance Renovate bot configuration with better grouping and security vulnerability alerts

### Compatibility

- Maintains full backward compatibility with local playbook files, glob patterns, and relative/absolute paths

[1.1.0]: https://github.com/arillso/go.ansible/compare/v1.0.0...v1.1.0

## [1.0.0] - 2025-04-13

### Changed

- **BREAKING:** Rename `AnsiblePlaybook` structure to `Playbook` - requires code updates for all references
- **BREAKING:** `Exec()` method now requires `context.Context` parameter
- **BREAKING:** Reorganize `Config` struct with new field groupings (General, SSH, Playbook, Vault, Facts, Galaxy)
- Implement new command building approach using `exec.CommandContext` with dynamic environment variables
- Enhance error handling using `github.com/pkg/errors` package
- Update and expand documentation in codebase and README
- Update Go version in `go.mod` from 1.18 to 1.23

### Added

- Extended configuration options for SSH, Vault, Facts, and Galaxy integration
- New `Config` fields: `PrivateKey`, `VaultPassword`, `GalaxyAPIServerURL`, `GalaxyCollectionsPath`
- Additional parameters: `CallbackWhitelist`, `PollInterval`, `GatherSubset`, `StrategyPlugin`
- Helper functions: `resolvePlaybooks`, `prepareTempFiles`, `cleanupTempFiles`
- Utility functions for command construction: `applyOption`, `addVerbose`, `appendExtraVars`
- Comprehensive unit tests for playbook resolution, temporary file handling, environment variables, and command building

### Removed

- `.all-contributorsrc` file
- Test playbook file `tests/test.yml`
- Outdated variables, comments, and redundant code segments

[1.0.0]: https://github.com/arillso/go.ansible/compare/v0.1.0...v1.0.0

## [0.1.0] - 2023-11-11

### Added

- Galaxy API authentication support with `GalaxyAPIKey`
- `GalaxyAPIServerURL` for configuring Galaxy API server
- `GalaxyCollectionsPath` for specifying collections path
- `GalaxyDisableGPGVerify` to disable GPG verification
- `GalaxyForceWithDeps` to force installation with dependencies
- `GalaxyIgnoreCerts` to ignore certificate checks
- `GalaxyIgnoreSignatureStatusCodes` for signature status code filtering
- `GalaxyKeyring` for keyring path configuration
- `GalaxyOffline` for offline mode
- `GalaxyPre` for pre-release version installation
- `GalaxyRequiredValidSignatureCount` for signature validation
- `GalaxyRequirementsFile` for requirements file path
- `GalaxySignature` for signature specification
- `GalaxyTimeout` for operation timeout configuration
- `GalaxyUpgrade` to enable collection upgrades
- `GalaxyNoDeps` to disable dependency resolution

[0.1.0]: https://github.com/arillso/go.ansible/compare/v0.0.4...v0.1.0

## [0.0.4] - 2023-11-09

### Fixed

- Correct 'Config' field case sensitivity in ansiblePlaybook ([#7])

[#7]: https://github.com/arillso/go.ansible/pull/7
[0.0.4]: https://github.com/arillso/go.ansible/compare/v0.0.3...v0.0.4

## [0.0.3] - 2023-11-09

### Added

- `GalaxyForce` boolean variable ([#6])

[#6]: https://github.com/arillso/go.ansible/pull/6
[0.0.3]: https://github.com/arillso/go.ansible/compare/v0.0.2...v0.0.3

## [0.0.2] - 2022-07-28

### Added

- Environment variable `ANSIBLE_GALAXY_DISPLAY_PROGRESS` with value `False` ([#2])

### Changed

- Update github.com/urfave/cli/v2 from 2.2.0 to 2.3.0 ([#1])
- Update github.com/joho/godotenv from 1.3.0 to 1.4.0 ([#4])

### Contributors

This release includes the first contributions from:
- @dependabot-preview in [#1]
- @sbaerlocher in [#2]
- @dependabot in [#4]

[#1]: https://github.com/arillso/go.ansible/pull/1
[#2]: https://github.com/arillso/go.ansible/pull/2
[#4]: https://github.com/arillso/go.ansible/pull/4
[0.0.2]: https://github.com/arillso/go.ansible/compare/v0.0.1...v0.0.2

## [0.0.1] - 2021-04-05

### Added

- Initial release with core Ansible playbook execution functionality
- Basic configuration structure
- Command building and execution pipeline

[0.0.1]: https://github.com/arillso/go.ansible/releases/tag/v0.0.1
